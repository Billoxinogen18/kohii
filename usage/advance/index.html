<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Android Video Playback made easy."><link href=https://eneim.github.io/kohii/usage/advance/ rel=canonical><meta name=author content="2019 Nam Nguyen, nam@ene.im"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../art/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>Advance usages - Kohii</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#546e7a><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Inter","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=stylesheet href=../../css/main.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-72567780-9", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=cyan> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#advance-usages tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://eneim.github.io/kohii title=Kohii aria-label=Kohii class="md-header-nav__button md-logo"> <img alt=logo src=../../art/ic_launcher-web.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Kohii </span> <span class=md-header-nav__topic> Advance usages </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/eneim/kohii/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://eneim.github.io/kohii title=Kohii class="md-nav__button md-logo"> <img alt=logo src=../../art/ic_launcher-web.png width=48 height=48> </a> Kohii </label> <div class=md-nav__source> <a href=https://github.com/eneim/kohii/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Kohii </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Overview class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Using Kohii </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Using Kohii </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../start/ title="Getting start" class=md-nav__link> Getting start </a> </li> <li class=md-nav__item> <a href=../basic/ title="Basic usages" class=md-nav__link> Basic usages </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Advance usages </label> <a href=./ title="Advance usages" class="md-nav__link md-nav__link--active"> Advance usages </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#using-builder class=md-nav__link> Using Builder </a> </li> <li class=md-nav__item> <a href=#using-unique-tag class=md-nav__link> Using unique tag </a> </li> <li class=md-nav__item> <a href=#showhide-thumbnail class=md-nav__link> Show/Hide thumbnail </a> </li> <li class=md-nav__item> <a href=#switching-a-video-playback-between-renderers class=md-nav__link> Switching a Video playback between renderers </a> </li> <li class=md-nav__item> <a href=#reuse-playerview-instance-for-multiple-videos class=md-nav__link> Reuse PlayerView instance for multiple Videos </a> </li> <li class=md-nav__item> <a href=#using-memorymode-to-improve-ux class=md-nav__link> Using MemoryMode to improve UX </a> </li> <li class=md-nav__item> <a href=#playing-many-videos-at-the-same-time class=md-nav__link> Playing many Videos at the same time </a> </li> <li class=md-nav__item> <a href=#manual-controller-experiment class=md-nav__link> Manual controller (experiment) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../demos/ title="Demo app" class=md-nav__link> Demo app </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Extending Kohii </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Extending Kohii </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../customize/terms/ title=Components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../../customize/custom_engine/ title="Custom Engine" class=md-nav__link> Custom Engine </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../changelog/ title=Changelog class=md-nav__link> Changelog </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> API </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/kohii-core/ title=kohii-core class=md-nav__link> kohii-core </a> </li> <li class=md-nav__item> <a href=../../api/kohii-exoplayer/ title=kohii-exoplayer class=md-nav__link> kohii-exoplayer </a> </li> <li class=md-nav__item> <a href=../../api/kohii-androidx/ title=kohii-androidx class=md-nav__link> kohii-androidx </a> </li> <li class=md-nav__item> <a href=../../api/kohii-ads/ title=kohii-ads class=md-nav__link> kohii-ads </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../code_of_conduct/ title="Code of Conduct" class=md-nav__link> Code of Conduct </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#using-builder class=md-nav__link> Using Builder </a> </li> <li class=md-nav__item> <a href=#using-unique-tag class=md-nav__link> Using unique tag </a> </li> <li class=md-nav__item> <a href=#showhide-thumbnail class=md-nav__link> Show/Hide thumbnail </a> </li> <li class=md-nav__item> <a href=#switching-a-video-playback-between-renderers class=md-nav__link> Switching a Video playback between renderers </a> </li> <li class=md-nav__item> <a href=#reuse-playerview-instance-for-multiple-videos class=md-nav__link> Reuse PlayerView instance for multiple Videos </a> </li> <li class=md-nav__item> <a href=#using-memorymode-to-improve-ux class=md-nav__link> Using MemoryMode to improve UX </a> </li> <li class=md-nav__item> <a href=#playing-many-videos-at-the-same-time class=md-nav__link> Playing many Videos at the same time </a> </li> <li class=md-nav__item> <a href=#manual-controller-experiment class=md-nav__link> Manual controller (experiment) </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/eneim/kohii/edit/master/docs/usage/advance.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=advance-usages>Advance usages<a class=headerlink href=#advance-usages title="Permanent link">&para;</a></h1> <p>Advance usages session will focus on using <strong>Kohii</strong> with <strong>ExoPlayer</strong>. Using others <em>extensions</em> will be discussed in more advance topics, because each extension is built with different ability.</p> <p>Here, we assume that you are familiar with <strong>ExoPlayer</strong>, including its core components (Player, ExoPlayer, SimpleExoPlayer, MediaSource, etc) and UI system (PlayerView, PlayerControlView, ControlDispatcher, etc).</p> <p>This session may use some keywords about components in <strong>Kohii</strong> like <strong>Container</strong>, <strong>Bucket</strong>, etc. You can find their definitions here: <a href=../../customize/terms>Components</a>.</p> <h2 id=using-builder>Using Builder<a class=headerlink href=#using-builder title="Permanent link">&para;</a></h2> <p><strong>Kohii</strong> instance can be constructed using <code>Builder</code>. By default, calling <code>Kohii[context]</code> will create or reuse an instance with default implementation. For advance users, it is more flexible to be able to customize this. <strong>Kohii</strong> provides <code>Builder</code> to make this happen:</p> <div class=superfences-tabs> <input name=__tabs_1 type=radio id=__tab_1_0 checked=checked> <label for=__tab_1_0>Kotlin</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code><span style="color: #8B008B; font-weight: bold">val</span> playableCreator = MyCustomPlayableCreator()
<span style="color: #8B008B; font-weight: bold">val</span> builder = Kohii.Builder(context)
    .setPlayableCreator(playableCreator)
<span style="color: #8B008B; font-weight: bold">val</span> kohii = builder.build()
</code></pre></div></div> <input name=__tabs_1 type=radio id=__tab_1_1> <label for=__tab_1_1>Java</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>PlayableCreator&lt;PlayerView&gt; playableCreator = <span style="color: #8B008B; font-weight: bold">new</span> MyCustomPlayableCreator();
Kohii.<span style="color: #658b00">Builder</span> builder = <span style="color: #8B008B; font-weight: bold">new</span> Kohii.<span style="color: #658b00">Builder</span>(context)
    .<span style="color: #658b00">setPlayableCreator</span>(playableCreator);
Kohii kohii = builder.<span style="color: #658b00">build</span>();
</code></pre></div></div> </div> <p>If you still want to use the default <code>PlayerViewPlayableCreator</code>, it can be constructed by its own Builder too, which will requires a <code>BridgeCreatorFactory</code> which is of type <code>Context.() -&gt; BridgeCreator&lt;PlayerView&gt;</code>:</p> <div class=superfences-tabs> <input name=__tabs_2 type=radio id=__tab_2_0 checked=checked> <label for=__tab_2_0>Kotlin</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code><span style="color: #8B008B; font-weight: bold">val</span> playableCreator: PlayableCreator&lt;PlayerView&gt; =
  PlayerViewPlayableCreator.Builder(<span style="color: #8B008B; font-weight: bold">this</span>)
    .setBridgeCreatorFactory(factory).build()
</code></pre></div></div> </div> <p>Please take a look at the source for all available builder parameters.</p> <h2 id=using-unique-tag>Using unique tag<a class=headerlink href=#using-unique-tag title="Permanent link">&para;</a></h2> <p>To have the automatic playback works, you just need this:</p> <div class=superfences-tabs> <input name=__tabs_3 type=radio id=__tab_3_0 checked=checked> <label for=__tab_3_0>Kotlin</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>kohii.setUp(videoUrl).bind(playerView)
</code></pre></div></div> <input name=__tabs_3 type=radio id=__tab_3_1> <label for=__tab_3_1>Java</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>kohii.<span style="color: #658b00">setUp</span>(videoUrl).<span style="color: #658b00">bind</span>(playerView);
</code></pre></div></div> </div> <p>With this one line, once user scrolls some Videos off screen, and then scrolls them back, the playback position will be reset and the Videos will start from the beginning. If you want the Videos to start from where it was before being scrolled off screen, you need to set an <strong><em>application wide unique tag</em></strong> for the Video. Sample code as below:</p> <div class=superfences-tabs> <input name=__tabs_4 type=radio id=__tab_4_0 checked=checked> <label for=__tab_4_0>Kotlin</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>kohii.setUp(videoUrl) {
  tag = videoUniqueTag
}
    .bind(playerView)
</code></pre></div></div> </div> <p>By having a unique tag, your Video state will also be retained across configuration changes like Window size change, orientation change or other system config changes. So it is highly recommended to have unique tags for your Videos.</p> <table> <thead> <tr> <th align=left>With tag</th> <th align=left>Without tag</th> </tr> </thead> <tbody> <tr> <td align=left><img src=/assets/kohii_with_tag.gif width=288></td> <td align=left><img src=/assets/kohii_without_tag.gif width=288></td> </tr> </tbody> </table> <h2 id=showhide-thumbnail>Show/Hide thumbnail<a class=headerlink href=#showhide-thumbnail title="Permanent link">&para;</a></h2> <p><strong>Kohii</strong> provides a special interface called <a href=../../api/kohii-core/kohii.v1.core/-playback/-artwork-hint-listener/ ><code>ArtworkHintListener</code></a>. With this interface, <strong>Kohii</strong> can tell client when it should show/hide thumbnail (or <em>artwork</em> in <strong>Kohii</strong>'s term). Sample code:</p> <div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code><span style="color: #228B22">// 1. Let ViewHolder implement ArtworkHintListener interface.</span>
<span style="color: #8B008B; font-weight: bold">class</span> <span style="color: #008b45; font-weight: bold">VideoViewHolder</span>(itemView: View): ViewHolder(itemView), ArtworkHintListener {

  <span style="color: #8B008B; font-weight: bold">val</span> thumbnail: ImageView = <span style="color: #228B22">// ... this is the ImageView for the thumbnail.</span>

  <span style="color: #228B22">// Override this callback to show/hide thumbnail.</span>
  <span style="color: #8B008B; font-weight: bold">override</span> <span style="color: #8B008B; font-weight: bold">fun</span> <span style="color: #008b45">onArtworkHint</span>(
    shouldShow: Boolean,
    position: Long,
    state: Int
  ) {
    thumbnail.isVisible = shouldShow
  }
}

<span style="color: #228B22">// 2. Provide the ArtworkHintListener when setting up the Video in ViewHolder</span>
kohii.setUp(assetVideoUri) {
  artworkHintListener = <span style="color: #8B008B; font-weight: bold">this</span>@VideoViewHolder
}
  .bind(playerView)
</code></pre></div> <p>You can see this setup in action in <a href=https://github.com/eneim/kohii/tree/dev-v1/kohii-sample/src/main/java/kohii/v1/sample/ui/grid>this demo</a>.</p> <p>In the callback <code>onArtworkHint</code>, other than a boolean flag <code>shouldShow</code> which is a hint from <strong>Kohii</strong> about if the artwork should be shown or hidden, there is also <code>position</code> which is the current position of the Video, and <code>state</code> which is current state of the player. Using these values, you can have your own behavior, other than just show/hide the ImageView.</p> <h2 id=switching-a-video-playback-between-renderers>Switching a Video playback between renderers<a class=headerlink href=#switching-a-video-playback-between-renderers title="Permanent link">&para;</a></h2> <p>In practice, you may find yourself try to <em>bring</em> a Video from a <code>PlayerView</code> to another <code>PlayerView</code>. Doing so can be as simple as calling bind to the destination <code>PlayerView</code>:</p> <div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>kohii.setUp(videoUrl) {
  tag = videoTag
}.bind(olayerView1)

<span style="color: #228B22">// Later, switch to another `PlayerView`</span>
kohii.setUp(videoUrl) {
  tag = videoTag
}.bind(playerView2)
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Note that you need to set the same unique <code>tag</code> to the Video, so that after switching to another <code>PlayerView</code>, it keeps playing smoothly, without being reset to beginning.</p> </div> <p>To help you simplify the steps, the call <code>bind(playerView1)</code> with a valid tag will return an object called <a href=../../api/kohii-core/kohii.v1.core/-rebinder/ ><code>Rebinder</code></a>. This <code>Rebinder</code> has one method <code>bind</code> so you can reuse this object to easily rebind a Video to any <code>PlayerView</code>. <code>Rebinder</code> is also a <code>Parcelable</code>, so you can pass this object around.</p> <p>Please check <a href=https://github.com/eneim/kohii/tree/dev-v1/kohii-sample/src/main/java/kohii/v1/sample/ui/sview>this demo</a> to see how it uses <code>Rebinder</code> to switch a Video from <code>PlayerView</code> to dialog and back.</p> <h2 id=reuse-playerview-instance-for-multiple-videos>Reuse PlayerView instance for multiple Videos<a class=headerlink href=#reuse-playerview-instance-for-multiple-videos title="Permanent link">&para;</a></h2> <p>Until now, the setup code is always <code>kohii.setUp(videoUrl).bind(playerView)</code> which may let you think that you will need to bind the Video to a <code>PlayerView</code> instance.</p> <p>In <strong>Kohii</strong>, target of the method <code>bind</code> is called <a href=../../customize/terms/#renderer-and-container><code>container</code></a>. While <code>PlayerView</code> is the place where Video content is rendered (and therefore it is called <a href=../../customize/terms/#renderer-and-container><code>renderer</code></a>, it can also be a <code>container</code> which <em>contains itself</em>).</p> <p>You can bind the Video to any <code>ViewGroup</code> as container, as long as either it is a <code>renderer</code> itself, or it has no children so that it <em>can contain</em> a <code>renderer</code> later. When you bind to a <em>non-renderer</em> <code>container</code>, for example an empty <code>FrameLayout</code>, <strong>Kohii</strong> will automatically prepare and add the <code>PlayerView</code> instance to that <code>FrameLayout</code> dynamically. At the same time, the unnecessary <code>PlayerView</code> instance will be removed from <code>container</code> and put back to a <code>Pool</code>. This way, only a few <code>PlayerView</code> instances will be created and reused for as many container/Videos as possible.</p> <p>By default, <strong>Kohii</strong> has its own logic for creating and recycling <code>PlayerView</code>, but developers can build their own by extending <a href=../../api/kohii-core/kohii.v1.core/-engine><strong>Engine</strong></a> - another important component of <strong>Kohii</strong>. Extending <strong>Engine</strong> and building custom playback logic will be discussed in topics for developers.</p> <h2 id=using-memorymode-to-improve-ux>Using MemoryMode to improve UX<a class=headerlink href=#using-memorymode-to-improve-ux title="Permanent link">&para;</a></h2> <p>Your screen may contain many Videos at a time, and preload Videos forward so they can start as soon as possible is a legit requirement. In practice, preloading Videos consumes a lot of system resource like memory, network and power. To address this need in proper way, <strong>Kohii</strong> provides a special control flag called <a href=../../api/kohii-core/kohii.v1.core/-memory-mode/ >MemoryMode</a>. The idea behinds <code>MemoryMode</code> is as below:</p> <ul> <li> <p>The idea is to allow <strong>Kohii</strong> to <em>preload around Video of interest<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup></em>. When <em>the Video of interest</em> is playing, at the same time <strong>Kohii</strong> will prepare the closet Videos <em>around</em> it: the first on top, the first below, the first to the left and/or the first to the right, and the second closet Videos, etc ...</p> </li> <li> <p>To control the maxinum number of Videos to prepare, <strong>Kohiii</strong> needs client to explixitly define this (with a default behavior to be automatic).</p> </li> </ul> <p><code>MemoryMode</code> is the information client uses to define this behavior. To use it, you need to update the code as below:</p> <div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code><span style="color: #aa0000">- kohii.register(this)</span>
<span style="color: #00aa00">+ kohii.register(this, MemoryMode.BALANCED)</span>
</code></pre></div> <p>While allowing client to define this behavior, <strong>Kohii</strong> will strictly observe system memory status, and will override that behavior on demand to prevent your app from behaving unexpectedly.</p> <h2 id=playing-many-videos-at-the-same-time>Playing many Videos at the same time<a class=headerlink href=#playing-many-videos-at-the-same-time title="Permanent link">&para;</a></h2> <p><em>Available from v1.1.0.2011003</em></p> <p><img src=/assets/kohii_demo_multi_player.gif width=216 style="display: block; margin: 0 auto;"></p> <p>From v1.1.0.2011003, <strong>Kohii</strong> adds <em>Playback Selector</em> and <em>Playback Strategy</em> to support multiple playbacks. The <em>Selector</em> is a <em>Single Abstract Method</em> that accepts a collection of <em>candidate</em> (= the Playbacks that can play the media) and returns a collection of Playback that should play the media.</p> <p>This feature is enabled at <a href=/customize/terms/#bucket-manager-and-group>Bucket</a> level. Which means that: client can have multiple playbacks in a <strong>Bucket</strong> by using correct <em>Strategy</em> and <em>Selector</em>. The setup is easy: you can set the <em>Strategy</em> and <em>Selector</em> at the time you add the <strong>Bucket</strong>.</p> <div class=superfences-tabs> <input name=__tabs_5 type=radio id=__tab_5_0 checked=checked> <label for=__tab_5_0>Kotlin</label> <div class=superfences-content><div class=codehilite style="background: #eeeedd"><pre style="line-height: 125%"><span></span><code>kohii.register(<span style="color: #8B008B; font-weight: bold">this</span>)
    .addBucket(
        view = recyclerView,
        strategy = Strategy.MULTI_PLAYER,
        selector = { candidates -&gt;
          candidates.take(<span style="color: #B452CD">2</span>)
        }
    )
</code></pre></div></div> </div> <p>The code above will: add a new <strong>Bucket</strong> for the <code>recyclerView</code>, with <code>MULTI_PLAYER</code> Strategy and using a Selector that will select up to 2 Playbacks from the candidates to play.</p> <p>Note that, <em>Strategy</em> and <em>Selector</em> need to be set together to enable the multiple playbacks. If the client uses a <em>Selector</em> that selects many Playbacks, but uses the <code>SINGLE_PLAYER</code> Strategy, it will only play one Playback.</p> <p>The available <em>Strategies</em> are:</p> <ul> <li><code>MULTI_PLAYER</code>: play all Playbacks selected by the <em>Selector</em>.</li> <li><code>SINGLE_PLAYER</code>: play the first available Playback from the list selected by the <em>Selector</em>.</li> <li><code>NO_PLAYER</code>: do not let the <em>Selector</em> select anything.</li> </ul> <p><strong>NOTE</strong>: Mutiple playbacks comes with a caveat. In Video playback, audio focus is an important aspect. The client needs to not only respect the audio focus given by system, but also to respect the audio focuses among a Video with the others in the same Application. Therefore, when the client enable <code>MULTI_PLAYER</code> <em>Strategy</em>, the library will forcefully mute the audio of all available Playbacks, regardless the number of Playbacks selected by the <em>Selector</em>. Changing to <code>SINGLE_PLAYER</code> or <code>NO_PLAYER</code> <em>Strategy</em> will switch everything back to normal.</p> <h2 id=manual-controller-experiment>Manual controller (experiment)<a class=headerlink href=#manual-controller-experiment title="Permanent link">&para;</a></h2> <p><em>COMING SOON</em></p> <div class=footnote> <hr> <ol> <li id=fn:1> <p>The Video that is selected to play&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../basic/ title="Basic usages" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Basic usages </span> </div> </a> <a href=../demos/ title="Demo app" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Demo app </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Nam Nguyen, nam@ene.im </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/eneim/kohii target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.1",url:{base:"../.."}})</script> </body> </html>